<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.jzt56.singleticketsystem.mapper.AuctionTaskMapper">
    <!--竞价任务数据库表与实体类字段对接-->
    <resultMap id="AuctionTaskResultMap" type="cn.jzt56.singleticketsystem.entity.AuctionTask">
        <id column="Bid_Task_Id" property="bidTaskId" jdbcType="VARCHAR"/>
        <result column="Ord_Id" property="orderId" jdbcType="VARCHAR"/>
        <result column="User_Id" property="userId" javaType="STRING"/>
        <result column="Total_Quantity" property="totalQuantity" jdbcType="VARCHAR"/>
        <result column="Total_Volume" property="totalVolume" jdbcType="VARCHAR"/>
        <result column="Total_Weight" property="totalWeight" jdbcType="VARCHAR"/>
        <result column="Proposed_Price" property="proposedPrice" jdbcType="DECIMAL"/>
        <result column="Pick_Area" property="pickArea" jdbcType="VARCHAR"/>
        <result column="Deliver__Area" property="deliverArea" jdbcType="VARCHAR"/>
        <result column="Service_Time" property="serviceTime" jdbcType="VARCHAR"/>
        <result column="Release_Time" property="releaseTime" jdbcType="VARCHAR"/>
        <result column="SealedDisk_Time" property="sealedDiskTime" jdbcType="VARCHAR"/>
        <result column="Bid_Status" property="bidStatus" jdbcType="VARCHAR"/>
        <result column="Transaction_Price" property="transactionPrice" jdbcType="DECIMAL"/>
        <result column="Task_Type" property="taskType" jdbcType="VARCHAR"/>
        <result column="Bid_Task_Num" property="bidTaskNum" jdbcType="VARCHAR"/>
    </resultMap>


    <!-- 查询所有可竞价的任务单 -->
    <select id="findAllCurrentTask" resultMap="AuctionTaskResultMap">
        SELECT att.* FROM auction_task  att WHERE att.Bid_Task_Id
        NOT IN(SELECT bd.Bid_Task_Id FROM bidding_detail bd WHERE bd.User_Id= #{userId} AND Status='1') AND Bid_Status='1'
        <if test="pickArea  != null">
            AND Pick_Area LIKE CONCAT(CONCAT('%', #{pickArea }),'%') OR Deliver_Area LIKE CONCAT(CONCAT('%', #{pickArea }),'%')
        </if>
        <if test="deliverArea  != null">
            AND Pick_Area LIKE CONCAT(CONCAT('%', #{deliverArea }),'%') OR Deliver_Area LIKE CONCAT(CONCAT('%', #{deliverArea }),'%')
        </if>
        <if test="serviceTime !=null">
            AND Service_Time &lt; #{serviceTime}
        </if>
        <if test="taskType != null">
            AND Task_Type=#{taskType}
        </if>
    </select>
    <!-- 查询正在竞价的任务单 -->
    <select id="findBidded" parameterType="String" resultMap="AuctionTaskResultMap">
        SELECT att.* FROM auction_task att RIGHT  JOIN bidding_detail bd
          ON att.Bid_Task_Id=bd.Bid_Task_Id WHERE  bd.User_Id =#{arg0} AND att.User_Id in ('',null)  AND bd.Status='1'
    </select>


    <!-- 根据运输商id查询竞拍成功的订单 -->
    <select id="findAllSuccessCurrentTaskByUserId" parameterType="String" resultMap="AuctionTaskResultMap">
        SELECT *  FROM	auction_task
        WHERE
	      Bid_Status = '2'
        AND
          User_Id = #{userId}
    </select>
</mapper>